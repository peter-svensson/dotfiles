# DEPRECATED: use_nvm function (kept for backward compatibility)
# Modern setup uses fnm (Fast Node Manager) which has built-in automatic
# version switching via ~/.config/fish/conf.d/fnm.fish with --use-on-cd flag.
# fnm automatically detects .nvmrc and .node-version files without direnv.
#
# Legacy usage (if needed):
# 1) Node version specified in package.json, in .envrc add:
#      use nvm package.json
#    This requires that package.json contains something like
#      "engines": {
#        "node": ">=6.9.2"
#      },
#
# 2) Node version specified in .envrc add:
#      use nvm 6.9.2
#
# 3) Node version specified in .nvmrc, in .envrc add:
#      use nvm
use_nvm() {
  local node_version=$1

  if [[ $node_version = "package.json" ]]; then
    if has jq; then
      node_version=$(jq --raw-output '.engines.node | select (.!=null)' package.json | tr -d "<=> ")
    else
      echo "Parsing package.json for node version to use with direnv requires jq"
    fi
    if [[ -z $node_version ]]; then
      echo "No version found in package.json, falling back to .nvmrc"
    fi
  fi

  nvm_sh=~/.nvm/nvm.sh
  if [[ -e $nvm_sh ]]; then
    source $nvm_sh
    nvm use $node_version
  fi
}
